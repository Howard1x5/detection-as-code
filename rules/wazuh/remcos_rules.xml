<!-- Remcos RAT Detection Rules -->
<!-- Commercial RAT with keylogging, registry persistence -->
<!-- MITRE ATT&CK: T1056.001, T1547.001, T1071.001, T1055.012 -->

<group name="remcos,malware,rat,">

  <!-- Remcos: Registry persistence -->
  <rule id="100410" level="12">
    <if_sid>61615</if_sid>
    <field name="win.eventdata.targetObject" type="pcre2">(?i)\\CurrentVersion\\Run</field>
    <field name="win.eventdata.targetObject" type="pcre2">(?i)(Remcos|Windows\sUpdate|Microsoft\sUpdate|System\sUpdate)$</field>
    <mitre>
      <id>T1547.001</id>
    </mitre>
    <group>remcos,persistence,</group>
    <description>Remcos: Registry Run key persistence with characteristic name</description>
  </rule>

  <!-- Remcos: Keylogger file creation -->
  <rule id="100411" level="12">
    <if_sid>61601</if_sid>
    <field name="win.eventdata.targetFilename" type="pcre2">(?i)\\AppData\\(Roaming|Local\\Temp)\\</field>
    <field name="win.eventdata.targetFilename" type="pcre2">(?i)(logs\.dat|keylog\.dat|keylog\.txt|logs\.txt|\.rmc)$</field>
    <mitre>
      <id>T1056.001</id>
    </mitre>
    <group>remcos,collection,</group>
    <description>Remcos: Keylogger data file created</description>
  </rule>

  <!-- Remcos: Process hollowing into legitimate process -->
  <rule id="100412" level="13">
    <if_sid>61603</if_sid>
    <field name="win.eventdata.image" type="pcre2">(?i)(regasm|msbuild|installutil|regsvcs)\.exe$</field>
    <field name="win.eventdata.parentImage" type="pcre2">(?i)(cmd|powershell|wscript|cscript)\.exe$</field>
    <field name="win.eventdata.parentImage" negate="yes" type="pcre2">(?i)Visual\sStudio</field>
    <mitre>
      <id>T1055.012</id>
    </mitre>
    <group>remcos,defense_evasion,</group>
    <description>Remcos: Process hollowing - .NET utility spawned from script</description>
  </rule>

  <!-- Remcos: Network connection on typical ports -->
  <rule id="100413" level="10">
    <if_sid>61605</if_sid>
    <field name="win.eventdata.destinationPort" type="pcre2">^(2404|2405|2406|4782|5552|9034)$</field>
    <field name="win.eventdata.image" negate="yes" type="pcre2">(?i)(chrome|firefox|edge|opera)\.exe$</field>
    <mitre>
      <id>T1071.001</id>
    </mitre>
    <group>remcos,command_and_control,</group>
    <description>Remcos: Connection to typical C2 port</description>
  </rule>

  <!-- Remcos: Webcam/microphone access -->
  <rule id="100414" level="10">
    <if_sid>61603</if_sid>
    <field name="win.eventdata.image" negate="yes" type="pcre2">(?i)(zoom|teams|skype|discord|chrome|firefox)\.exe$</field>
    <field name="win.eventdata.commandLine" type="pcre2">(?i)(vidcap|waveIn|avicap32)</field>
    <mitre>
      <id>T1125</id>
      <id>T1123</id>
    </mitre>
    <group>remcos,collection,</group>
    <description>Remcos: Possible webcam/microphone capture activity</description>
  </rule>

  <!-- Remcos: Screenshot capture indicator -->
  <rule id="100415" level="8">
    <if_sid>61601</if_sid>
    <field name="win.eventdata.targetFilename" type="pcre2">(?i)\\AppData\\</field>
    <field name="win.eventdata.targetFilename" type="pcre2">(?i)(screenshot|capture|screen).*\.(jpg|png|bmp)$</field>
    <mitre>
      <id>T1113</id>
    </mitre>
    <group>remcos,collection,</group>
    <description>Remcos: Screenshot file creation detected</description>
  </rule>

  <!-- Remcos: Clipboard monitoring -->
  <rule id="100416" level="8">
    <if_sid>61603</if_sid>
    <field name="win.eventdata.image" negate="yes" type="pcre2">(?i)(explorer|notepad|chrome|firefox|code)\.exe$</field>
    <field name="win.eventdata.commandLine" type="pcre2">(?i)(GetClipboardData|OpenClipboard)</field>
    <mitre>
      <id>T1115</id>
    </mitre>
    <group>remcos,collection,</group>
    <description>Remcos: Clipboard access from suspicious process</description>
  </rule>

</group>
